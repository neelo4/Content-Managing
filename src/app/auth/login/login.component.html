describe('useGetOnboardingAndEdocsDetails', () => {
  // Keep existing test setup...

  it('should handle successful query completion and update app state', () => {
    // Mock the features to ensure query runs
    (useFeaturesConfig as jest.Mock).mockReturnValue(true);
    (useBrowserDetect as jest.Mock).mockReturnValue({ isMobileApp: false });
    (getActivePolicyStatus as jest.Mock).mockReturnValue(['ACTIVE']);

    // Create mock response data with proper typing
    const mockResponse = {
      getOnboardingAndEdocsStatus: {
        showOnboarding: true,
        showEdocs: false,
        policies: ['policy1', 'policy2'],
        onboardingType: 'test'
      }
    };

    // Set up mock for useApiQuery with proper typing
    mockUseApiQuery.mockImplementation((query: any, mapper: any, options: any) => {
      // Immediately call onCompleted with mock data
      if (options.onCompleted) {
        options.onCompleted(mockResponse);
      }
      return [
        jest.fn(),
        {
          data: mockResponse,
          loading: false,
          hasAuthenticationError: false,
          error: undefined
        }
      ];
    });

    // Create wrapper with proper context
    const wrapper: React.FC<{ children: React.ReactNode }> = ({ children }) => (
      <AppContext.Provider value={{ setAppState: mockSetAppState, appState: {} }}>
        {children}
      </AppContext.Provider>
    );

    // Render the hook
    const { result } = renderHook(() => useGetOnboardingAndEdocsDetails(mockAppState.setAppState), {
      wrapper
    });

    // Verify the hook result matches expected structure
    expect(result.current).toEqual({
      data: mockResponse,
      loading: false,
      hasAuthenticationError: false,
      error: undefined
    });

    // Verify setAppState was called with correct data
    expect(mockSetAppState).toHaveBeenCalled();
    
    // Get and verify the state update
    const updateStateCallback = mockSetAppState.mock.calls[0][0];
    const newState = updateStateCallback({});

    expect(newState).toEqual({
      onboardingAndEdocsResult: {
        showOnboarding: true,
        showEdocs: false,
        onboardingType: 'test'
      }
    });

    // Verify policies field was omitted
    expect(newState.onboardingAndEdocsResult).not.toHaveProperty('policies');
  });
});
