import { filterData } from './ContactUsSearch'; // Assuming the function is exported
import { FaqData } from './ContactUsUplift'; // Import the FaqData type if available

describe('filterData function', () => {
  const mockFaqData: FaqData = {
    "categories": {
      "payments": [
        {
          "question": "How do I make a BPAY payment?",
          "answer": "You can make a BPAY payment by calling your bank or using internet banking and selecting the BPAY option.",
          "feedbackOrder": 1,
          "analyticsValue": "faq-payments-make-bpay-payment"
        },
        {
          "question": "How can I check my payment status?",
          "answer": "You can check your payment status by logging into your account.",
          "answer1": "For older policies, please contact customer support.",
          "feedbackOrder": 2,
          "analyticsValue": "faq-payments-check-status"
        }
      ],
      "claims": [
        {
          "question": "How do I make a claim?",
          "answer": "You can make a claim online or by calling our claims department.",
          "feedbackOrder": 1,
          "analyticsValue": "faq-claims-make-claim"
        }
      ]
    }
  };

  const mockSetData = jest.fn();
  const mockSetNoResultSectionVisible = jest.fn();

  beforeEach(() => {
    jest.clearAllMocks();
  });

  test('filters data correctly when search term is found', () => {
    const searchTerm = 'BPAY';
    filterData(searchTerm, mockFaqData, mockSetData, mockSetNoResultSectionVisible);

    expect(mockSetData).toHaveBeenCalledWith({
      "categories": {
        "payments": [
          {
            "question": "How do I make a BPAY payment?",
            "answer": "You can make a BPAY payment by calling your bank or using internet banking and selecting the BPAY option.",
            "feedbackOrder": 1,
            "analyticsValue": "faq-payments-make-bpay-payment"
          }
        ]
      }
    });
    expect(mockSetNoResultSectionVisible).not.toHaveBeenCalled();
  });

  test('filters data correctly when search term matches category', () => {
    const searchTerm = 'payments';
    filterData(searchTerm, mockFaqData, mockSetData, mockSetNoResultSectionVisible);

    expect(mockSetData).toHaveBeenCalledWith({
      "categories": {
        "payments": mockFaqData.categories.payments
      }
    });
    expect(mockSetNoResultSectionVisible).not.toHaveBeenCalled();
  });

  test('sets no results section visible when no matches found', () => {
    const searchTerm = 'nonexistent';
    filterData(searchTerm, mockFaqData, mockSetData, mockSetNoResultSectionVisible);

    expect(mockSetData).toHaveBeenCalledWith({});
    expect(mockSetNoResultSectionVisible).toHaveBeenCalledWith(true);
  });

  test('handles case insensitive search', () => {
    const searchTerm = 'bpay';
    filterData(searchTerm, mockFaqData, mockSetData, mockSetNoResultSectionVisible);

    expect(mockSetData).toHaveBeenCalledWith({
      "categories": {
        "payments": [
          {
            "question": "How do I make a BPAY payment?",
            "answer": "You can make a BPAY payment by calling your bank or using internet banking and selecting the BPAY option.",
            "feedbackOrder": 1,
            "analyticsValue": "faq-payments-make-bpay-payment"
          }
        ]
      }
    });
  });

  test('matches content in answer1 field', () => {
    const searchTerm = 'older policies';
    filterData(searchTerm, mockFaqData, mockSetData, mockSetNoResultSectionVisible);

    expect(mockSetData).toHaveBeenCalledWith({
      "categories": {
        "payments": [
          {
            "question": "How can I check my payment status?",
            "answer": "You can check your payment status by logging into your account.",
            "answer1": "For older policies, please contact customer support.",
            "feedbackOrder": 2,
            "analyticsValue": "faq-payments-check-status"
          }
        ]
      }
    });
  });
});
