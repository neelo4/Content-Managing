import { render, waitFor } from '../../../test-utils/renderWithProviders';
import ContactUsSearch from './ContactUsSearch';
import { Brand } from '../../models/Brand';

jest.mock('../../iagBrandStore');

const mockClient = jest.fn() as any;

const onClearResults = jest.fn();

const setNoSearchTermSectionVisible = jest.fn();

describe('ContactUsSearch page tests', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('renders ContactUsSearch component', async () => {
    const { getByTestId } = render(
      <ApolloProvider client={mockClient}>
        <ContactUsSearch
          searchTerm="Payments"
          setNoResultSectionVisible={jest.fn()}
          setSearchTerm={jest.fn()}
          setData={jest.fn()}
          setresultSectionVisible={jest.fn()}
        />
      </ApolloProvider>,
      { brand: Brand.NRMA }
    );

    await waitFor(() => {
      expect(getByTestId('contact-us-search-btn')).toBeInTheDocument();
    });
  });

  it('filters data correctly when search term is found', () => {
    const component = new ContactUsSearch({
      tt: jest.fn(),
      setData: jest.fn(),
      searchTerm: 'payment',
      setSearchTerm: jest.fn(),
      setresultSectionVisible: jest.fn(),
      setNoResultSectionVisible: jest.fn(),
    });

    const mockFaqData = {
      'Category 1': [
        { question: 'How do I make a payment?', answer: 'You can make a payment online.' },
        { question: 'What is the refund policy?', answer: 'Refunds are processed within 7 days.' },
      ],
      'Category 2': [
        { question: 'How do I contact support?', answer: 'You can contact support via email or phone.' },
      ],
    };

    component.faqData = mockFaqData;
    component.filterData();

    expect(component.props.setData).toHaveBeenCalledWith({
      'Category 1': [
        { question: 'How do I make a payment?', answer: 'You can make a payment online.' },
      ],
    });
    expect(component.props.setNoResultSectionVisible).not.toHaveBeenCalled();
  });

  it('shows no results when search term is not found', () => {
    const component = new ContactUsSearch({
      tt: jest.fn(),
      setData: jest.fn(),
      searchTerm: 'nonexistent',
      setSearchTerm: jest.fn(),
      setresultSectionVisible: jest.fn(),
      setNoResultSectionVisible: jest.fn(),
    });

    const mockFaqData = {
      'Category 1': [
        { question: 'How do I make a payment?', answer: 'You can make a payment online.' },
      ],
    };

    component.faqData = mockFaqData;
    component.filterData();

    expect(component.props.setData).toHaveBeenCalledWith({});
    expect(component.props.setNoResultSectionVisible).toHaveBeenCalledWith(true);
  });

  it('handles empty search term', () => {
    const component = new ContactUsSearch({
      tt: jest.fn(),
      setData: jest.fn(),
      searchTerm: '',
      setSearchTerm: jest.fn(),
      setresultSectionVisible: jest.fn(),
      setNoResultSectionVisible: jest.fn(),
    });

    component.onSearchButtonClick();

    expect(component.props.setresultSectionVisible).toHaveBeenCalledWith(false);
    expect(component.state.noSearchTermSectionVisible).toBe(true);
  });

  it('updates search term on input change', () => {
    const setSearchTerm = jest.fn();
    const component = new ContactUsSearch({
      tt: jest.fn(),
      setData: jest.fn(),
      searchTerm: '',
      setSearchTerm,
      setresultSectionVisible: jest.fn(),
      setNoResultSectionVisible: jest.fn(),
    });

    const mockEvent = {
      preventDefault: jest.fn(),
      stopPropagation: jest.fn(),
      target: { value: 'new search term' },
    };

    component.onChangeSearchTerm(mockEvent as any);

    expect(setSearchTerm).toHaveBeenCalledWith('new search term');
    expect(component.props.setresultSectionVisible).toHaveBeenCalledWith(false);
    expect(component.props.setNoResultSectionVisible).toHaveBeenCalledWith(false);
  });
});
