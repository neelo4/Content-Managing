import React from 'react';
import { fireEvent, screen, waitFor } from '@testing-library/react';
import '@testing-library/jest-dom/extend-expect';
import ContactUsSearch from './ContactUsSearch';
import { render } from './customRender';
import { GlobalEventsContext } from '@iag-common/mfe-global-events-context';

// Mock the required modules and functions
jest.mock('@iag-common/mfe-global-events', () => ({
  dispatchTrackingEventToDocument: jest.fn(),
}));

jest.mock('react-router-dom', () => ({
  useNavigate: () => jest.fn(),
}));

jest.mock('../../utils/brandUtils', () => ({
  getBrandTitle: jest.fn(() => 'Mock Brand'),
}));

jest.mock('../../utils/partyUtils', () => ({
  getCustomerCheck: jest.fn(() => false),
}));

const mockSetData = jest.fn();
const mockSetSearchTerm = jest.fn();
const mockSetResultSectionVisible = jest.fn();
const mockSetNoResultSectionVisible = jest.fn();

const defaultProps = {
  tt: (key: string) => key,
  setData: mockSetData,
  searchTerm: '',
  setSearchTerm: mockSetSearchTerm,
  setresultSectionVisible: mockSetResultSectionVisible,
  setNoResultSectionVisible: mockSetNoResultSectionVisible,
};

const mockGlobalEventsContext = {
  dispatchEvent: jest.fn(),
};

describe('ContactUsSearch', () => {
  beforeEach(() => {
    jest.clearAllMocks();
  });

  it('renders without crashing', () => {
    render(
      <GlobalEventsContext.Provider value={mockGlobalEventsContext}>
        <ContactUsSearch {...defaultProps} />
      </GlobalEventsContext.Provider>
    );
    expect(screen.getByTestId('contact-us-search-btn')).toBeInTheDocument();
  });

  it('updates search term on input change', () => {
    render(
      <GlobalEventsContext.Provider value={mockGlobalEventsContext}>
        <ContactUsSearch {...defaultProps} />
      </GlobalEventsContext.Provider>
    );
    
    const input = screen.getByPlaceholderText('pages.contactUsUplift.info.contactUsSearchInputPlaceholder');
    fireEvent.change(input, { target: { value: 'test search' } });
    
    expect(mockSetSearchTerm).toHaveBeenCalledWith('test search');
  });

  it('handles search button click with empty search term', () => {
    render(
      <GlobalEventsContext.Provider value={mockGlobalEventsContext}>
        <ContactUsSearch {...defaultProps} searchTerm="" />
      </GlobalEventsContext.Provider>
    );
    
    const searchButton = screen.getByTestId('contact-us-search-btn');
    fireEvent.click(searchButton);
    
    expect(mockSetResultSectionVisible).toHaveBeenCalledWith(false);
    expect(mockSetNoResultSectionVisible).toHaveBeenCalledWith(false);
  });

  it('handles search button click with non-empty search term', async () => {
    const mockFaqData = {
      category1: [{ question: 'Test Question', answer: 'Test Answer' }],
    };

    jest.spyOn(React, 'useContext').mockImplementation(() => ({
      tt: (key: string) => {
        if (key === 'pages.contactUsUplift.categories') {
          return mockFaqData;
        }
        return key;
      },
    }));

    render(
      <GlobalEventsContext.Provider value={mockGlobalEventsContext}>
        <ContactUsSearch {...defaultProps} searchTerm="test" />
      </GlobalEventsContext.Provider>
    );
    
    const searchButton = screen.getByTestId('contact-us-search-btn');
    fireEvent.click(searchButton);
    
    await waitFor(() => {
      expect(mockSetResultSectionVisible).toHaveBeenCalledWith(true);
      expect(mockSetData).toHaveBeenCalled();
    });
  });

  // Add more tests as needed for other functions and edge cases
});
