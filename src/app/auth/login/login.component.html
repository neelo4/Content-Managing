import { renderHook } from '@testing-library/react-hooks';
import { MockedProvider } from '@apollo/client/testing';
import { useGetOnboardingAndEdocsDetails } from './useGetOnboardingAndEdocsDetails';
import { AppContext } from '../../AppContext';
import { useFeaturesConfig } from '../../features-config';
import useBrowserDetect from '../useBrowserDetect';
import { ONBOARDING_KEY } from '../../components/shared/Constants';
import { getActivePolicyStatus } from '../../models/PolicyStatus';
import React from 'react';

// Mock dependencies
jest.mock('../../features-config');
jest.mock('../useBrowserDetect');
jest.mock('../../models/PolicyStatus');

describe('useGetOnboardingAndEdocsDetails', () => {
  const mockSetAppState = jest.fn();

  beforeEach(() => {
    jest.clearAllMocks();
    window.sessionStorage.clear();
    
    // Set up default mocks
    (useFeaturesConfig as jest.Mock).mockReturnValue(true);
    (useBrowserDetect as jest.Mock).mockReturnValue({ isMobileApp: false });
    (getActivePolicyStatus as jest.Mock).mockReturnValue(['ACTIVE']);
  });

  it('should skip query when session storage has onboarding key', () => {
    // Set up session storage
    window.sessionStorage.setItem(ONBOARDING_KEY, 'true');

    const wrapper = ({ children }: { children: React.ReactNode }) => (
      <AppContext.Provider value={{ setAppState: mockSetAppState, appState: {} }}>
        <MockedProvider mocks={[]}>
          {children}
        </MockedProvider>
      </AppContext.Provider>
    );

    const { result } = renderHook(() => useGetOnboardingAndEdocsDetails(), { wrapper });

    // Verify the exact shape of the returned object
    expect(result.current).toEqual({
      data: undefined,
      loading: false,
      error: undefined,
      hasAuthenticationError: false
    });
  });
});
