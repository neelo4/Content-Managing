extends ../_layouts/base

include ../_modules/atoms/btn/btn
include ../_modules/atoms/input-set/input-set
include ../_modules/atoms/spinner/spinner
include ../_modules/atoms/custom-select/custom-select
include ../_modules/atoms/type-select/type-select

include ../_modules/molecules/search-bar/search-bar
include ../_modules/molecules/modal/modal
include ../_modules/molecules/pagination/pagination
include ../_modules/molecules/listing-filters/listing-filters

include ../_modules/organisms/navbar/navbar
include ../_modules/organisms/table-listing/table-listing


block config
  //- Correct base url pathing for this page
  - var baseUrl = '../'
  - var pageTitle = 'GE Zeus'
  - var data= site.data.auditTrail

block navbar
  +navbar(data.navbar)


block content
  .audit-listing(data-get-endpoint="../apis/audit-listing.json" data-items-per-page="10")
    .container--medium
      +listing-filters()
        form(action="#" method="GET")
          +search-bar(data.searchBar)

          .listing-filters__row
            +type-select(data.typeSelect).input-set.type-select--rounded(data-suggestion-endpoint="../apis/projects-list.json")
            each dropdown in data.dropdowns
              +custom-select(dropdown).custom-select--rounded


      +table-listing().sortable(data-sortby="Date-Time" data-sort-order=":desc")
        .table-listing__top
          h2.table-listing__title Audit Trail
          +btn({text: 'Export'})(type="button" data-trigger-modal="export").btn--blue

        table.table-listing__table
          thead
            tr
              th Name & Role
              th Project
              th Activity
              th
                button(data-sort-value="Date-Time" type="button") Date & Time
          tbody.table-listing__results

        +spinner()
        +pagination({
          jump: {
            id: 'audit-listing__jump',
            label: 'jump to :',
            placeholder: '1'
          }
        })


block modals
  +modal({
    title: 'Export',
    buttons: [
      {
        isClose: true,
        text: "Close",
        __btnClass: 'btn--white'
      },
      {
        text: "Export",
        __btnClass: 'btn--blue audit-listing__modal-export-btn'
      }
    ]
  }).audit-modal.modal--form(data-modal-name="export" data-file-endpoint="../apis/audit-export.json" )
    hr
    form(action="#" method="post")
      +input-set(data.exportFileName)
      +input-set(data.exportUser)

      +type-select(data.exportTypeSelect).input-set(data-suggestion-endpoint="../apis/projects-list.json")

      each dropdown in data.exportDropdowns
        +custom-select(dropdown)

      p.modal--form__message


block dotTemplates
  script(id="audit-listing-template" class="module-js-template" type="text/template")
    |{{~it :log}}
    tr.listing-row
      td
        h4.listing-row__highlight {{= log.Name}}
        |{{? log.Role}}
        span.listing-row__subtitle  {{= log.Role}}
        |{{?}}
      td {{= log.Project}}
      td
        p {{= log.Activity}}
      td {{= log.DateTime}}
    |{{~}}


block moduleStylesheets
  link(rel='stylesheet' class="module-style" href='/assets/audit-trail/styles/audit-trail.css')

block moduleScripts
  script(class="module-script" src= '/assets/audit-trail/scripts/audit-trail.js')
